<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Sisters Qiyaam Bingo</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--midnight:#0a0e27;--deep-navy:#111638;--royal-purple:#2d1b69;--gold:#d4a853;--gold-light:#f0d48a;--gold-glow:rgba(212,168,83,0.3);--teal:#2ec4b6;--teal-glow:rgba(46,196,182,0.2);--white:#fff;--white-soft:rgba(255,255,255,0.85);--white-muted:rgba(255,255,255,0.5);--filled-bg:linear-gradient(135deg,#1a3a5c,#2d1b69);--filled-border:var(--gold);--card-bg:rgba(255,255,255,0.06);--card-border:rgba(255,255,255,0.1);--danger:#e74c3c;--success:#2ecc71;--font-display:'Playfair Display',Georgia,serif;--font-body:'DM Sans',-apple-system,sans-serif;--radius:12px;--radius-sm:8px;--radius-lg:20px}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;-webkit-tap-highlight-color:transparent}
body{font-family:var(--font-body);background:var(--midnight);color:var(--white);min-height:100dvh;overflow-x:hidden;position:relative}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(1.5px 1.5px at 20% 30%,var(--gold) 50%,transparent 100%),radial-gradient(1px 1px at 40% 70%,var(--teal) 50%,transparent 100%),radial-gradient(1.2px 1.2px at 60% 20%,#e8a0bf 50%,transparent 100%),radial-gradient(1px 1px at 80% 60%,var(--gold) 50%,transparent 100%),radial-gradient(1.5px 1.5px at 10% 80%,var(--teal) 50%,transparent 100%);background-size:250px 250px;animation:twinkle 8s ease-in-out infinite alternate;z-index:0;pointer-events:none}
@keyframes twinkle{0%{opacity:.4}50%{opacity:.7}100%{opacity:.4}}

/* Lanterns - more visible */
.lantern{position:fixed;z-index:0;pointer-events:none;opacity:.12;filter:drop-shadow(0 0 12px var(--gold))}
.lantern-1{top:3%;left:6%;width:70px;animation:sway 6s ease-in-out infinite}
.lantern-2{top:15%;right:8%;width:55px;animation:sway 7s ease-in-out infinite .5s}
.lantern-3{top:40%;left:3%;width:60px;animation:sway 5.5s ease-in-out infinite 1s}
.lantern-4{top:60%;right:5%;width:65px;animation:sway 6.5s ease-in-out infinite 1.5s}
.lantern-5{top:80%;left:8%;width:50px;animation:sway 7.5s ease-in-out infinite 2s}
.lantern-6{top:25%;right:3%;width:45px;animation:sway 5s ease-in-out infinite 2.5s}
@keyframes sway{0%,100%{transform:rotate(-3deg)}50%{transform:rotate(3deg)}}

.moon-decoration{position:fixed;top:20px;right:30px;width:60px;height:60px;border-radius:50%;box-shadow:inset -18px -2px 0 0 var(--gold),0 0 20px var(--gold-glow),0 0 40px rgba(212,168,83,.15);z-index:1;pointer-events:none;opacity:.8}

/* === FULL-PAGE SCREENS === */
.screen{display:none;position:fixed;inset:0;z-index:2;overflow-y:auto;-webkit-overflow-scrolling:touch}
.screen.active{display:flex;flex-direction:column;animation:fadeIn .3s ease}
.screen-inner{max-width:560px;width:100%;margin:0 auto;padding:16px;flex:1;display:flex;flex-direction:column}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* Shared header block inside each screen that needs it */
.screen-header{text-align:center;padding:16px 0 8px;flex-shrink:0}
.screen-header h1{font-family:var(--font-display);font-size:clamp(1.3rem,5vw,1.8rem);font-weight:800;color:var(--gold-light);text-shadow:0 0 20px var(--gold-glow);letter-spacing:.5px;line-height:1.2}
.screen-header .subtitle{font-size:clamp(.7rem,2.5vw,.85rem);color:var(--white-muted);margin-top:4px;letter-spacing:2px;text-transform:uppercase}
.screen-footer{text-align:center;padding:8px 0 12px;font-size:.7rem;color:var(--white-muted);letter-spacing:.5px;flex-shrink:0}

/* Timer bar - fixed overlay */
.timer-bar{display:none;position:fixed;top:0;left:0;right:0;z-index:60;align-items:center;justify-content:center;gap:10px;padding:8px 16px;background:rgba(10,14,39,.95);border-bottom:1px solid var(--card-border);backdrop-filter:blur(10px)}
.timer-bar.visible{display:flex}
.timer-bar .timer-display{font-family:var(--font-display);font-size:clamp(1.2rem,4vw,1.5rem);font-weight:700;color:var(--gold-light);letter-spacing:2px;min-width:80px;text-align:center}
.timer-bar .timer-label{font-size:.7rem;color:var(--white-muted);text-transform:uppercase;letter-spacing:1px}
.timer-bar.urgent .timer-display{color:var(--danger);animation:pulse-text 1s ease-in-out infinite}
.has-timer{padding-top:50px}
@keyframes pulse-text{0%,100%{opacity:1}50%{opacity:.5}}

/* Login */
.login-center{flex:1;display:flex;align-items:center;justify-content:center}
.login-card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius-lg);padding:32px 24px;width:100%;max-width:380px;backdrop-filter:blur(20px);text-align:center}
.login-card h2{font-family:var(--font-display);font-size:clamp(1.2rem,4vw,1.4rem);color:var(--gold-light);margin-bottom:4px}
.login-card .login-sub{font-size:.8rem;color:var(--white-muted);margin-bottom:24px}
.form-group{margin-bottom:16px;text-align:left}
.form-group label{display:block;font-size:.75rem;font-weight:600;color:var(--white-muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.form-group input,.form-group textarea{width:100%;padding:12px 14px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);border-radius:var(--radius-sm);color:var(--white);font-family:var(--font-body);font-size:1rem;outline:none;transition:border-color .2s,box-shadow .2s}
.form-group input:focus,.form-group textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px var(--gold-glow)}
.form-group input::placeholder,.form-group textarea::placeholder{color:var(--white-muted)}
.form-group textarea{resize:vertical;min-height:60px}
.form-group input[type="number"]{-moz-appearance:textfield;width:70px;text-align:center}
.check-row{display:flex;align-items:center;gap:10px;margin:12px 0;cursor:pointer;font-size:.85rem;color:var(--white-soft)}
.check-row input[type="checkbox"]{width:20px;height:20px;accent-color:var(--gold);cursor:pointer}

.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 24px;border:none;border-radius:var(--radius-sm);font-family:var(--font-body);font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s;min-height:48px;min-width:48px}
.btn-primary{background:linear-gradient(135deg,var(--gold),#c49a3a);color:var(--midnight);box-shadow:0 4px 15px var(--gold-glow)}
.btn-primary:hover{transform:translateY(-1px)}.btn-primary:active{transform:translateY(0)}
.btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none}
.btn-secondary{background:rgba(255,255,255,.1);color:var(--white);border:1px solid rgba(255,255,255,.2)}
.btn-danger{background:var(--danger);color:var(--white)}
.btn-small{padding:8px 16px;font-size:.8rem;min-height:40px}
.w-full{width:100%}.mt-8{margin-top:8px}.mt-12{margin-top:12px}
.hidden{display:none!important}
.login-error{color:var(--danger);font-size:.8rem;margin-top:8px;min-height:20px}

/* Toast */
.toast-container{position:fixed;top:10px;left:50%;transform:translateX(-50%);z-index:200;pointer-events:none;display:flex;flex-direction:column;gap:8px;align-items:center}
.toast{background:linear-gradient(135deg,rgba(46,196,182,.95),rgba(29,130,120,.95));color:var(--white);padding:14px 24px;border-radius:var(--radius);font-weight:600;font-size:.95rem;box-shadow:0 8px 30px rgba(0,0,0,.4);animation:toastIn .4s ease,toastOut .4s ease 3.5s forwards;text-align:center;max-width:340px}
@keyframes toastIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
@keyframes toastOut{to{opacity:0;transform:translateY(-20px)}}

/* Lobby */
.lobby-center{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;overflow:hidden}
.lobby-center h2{font-family:var(--font-display);font-size:clamp(1.3rem,5vw,1.6rem);color:var(--gold-light);margin-bottom:8px}
.lobby-center .lobby-sub{font-size:.9rem;color:var(--white-soft);margin-bottom:24px}
.lobby-center .loading-spinner{width:30px;height:30px;border-width:3px;margin-bottom:16px}
.floating-msg{position:absolute;font-size:clamp(.75rem,2.5vw,.9rem);color:var(--white-muted);font-style:italic;opacity:0;animation:floatMsg 8s ease-in-out infinite;white-space:nowrap}
@keyframes floatMsg{0%{opacity:0;transform:translateY(20px)}15%{opacity:.6}50%{opacity:.6}65%{opacity:0;transform:translateY(-20px)}100%{opacity:0}}

/* Board */
.board-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px;flex-wrap:wrap;gap:4px}
.board-header .player-name{font-family:var(--font-display);font-size:clamp(.95rem,3.5vw,1.1rem);color:var(--gold-light)}
.board-header .filled-count{font-size:.85rem;color:var(--teal);font-weight:600}
.game-rules-tag{font-size:clamp(.65rem,2vw,.75rem);color:var(--white-muted);margin-bottom:8px;font-style:italic}
.bingo-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:clamp(3px,1vw,5px);margin-bottom:12px}
.bingo-cell{aspect-ratio:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:clamp(3px,.8vw,5px) clamp(2px,.5vw,4px);background:var(--card-bg);border:1.5px solid var(--card-border);border-radius:var(--radius-sm);cursor:pointer;transition:all .2s;position:relative;overflow:hidden;-webkit-user-select:none;user-select:none}
.bingo-cell:hover:not(.filled):not(.free-space){border-color:var(--gold);box-shadow:0 0 10px var(--gold-glow);transform:scale(1.02)}
.bingo-cell:active:not(.filled):not(.free-space){transform:scale(.97)}
.bingo-cell .cell-label{font-size:clamp(.42rem,1.4vw,.6rem);line-height:1.2;color:var(--white-soft);font-weight:500;hyphens:auto;overflow-wrap:break-word;word-break:break-word}
.bingo-cell .cell-sister{font-size:clamp(.36rem,1.1vw,.5rem);color:var(--gold-light);margin-top:2px;font-weight:600;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.bingo-cell.filled{background:var(--filled-bg);border-color:var(--filled-border);cursor:default;box-shadow:inset 0 0 15px rgba(212,168,83,.1)}
.bingo-cell.filled .cell-label{color:var(--white)}
.bingo-cell.filled::after{content:'\2713';position:absolute;top:2px;right:3px;font-size:clamp(.4rem,1vw,.55rem);color:var(--gold)}
.bingo-cell.free-space{background:linear-gradient(135deg,var(--royal-purple),#1a3a5c);border-color:var(--gold);cursor:default}
.bingo-cell.free-space .cell-label{font-family:var(--font-display);font-size:clamp(.45rem,1.3vw,.6rem);font-weight:700;color:var(--gold-light)}

/* Bingo celebration */
.bingo-celebrate{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px}
.bingo-celebrate h1{font-family:var(--font-display);font-size:clamp(2rem,8vw,3rem);color:var(--gold-light);text-shadow:0 0 30px var(--gold-glow);animation:celebPulse 2s ease-in-out infinite}
.bingo-celebrate .celebrate-sub{font-size:clamp(1rem,3vw,1.2rem);color:var(--white-soft);margin-top:12px}
.bingo-celebrate .celebrate-emoji{font-size:clamp(3rem,10vw,5rem);margin:20px 0;animation:celebBounce 1s ease infinite}
@keyframes celebPulse{0%,100%{text-shadow:0 0 20px var(--gold-glow)}50%{text-shadow:0 0 40px var(--gold-glow),0 0 60px rgba(212,168,83,.3)}}
@keyframes celebBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
@keyframes winPulse{0%,100%{box-shadow:0 0 10px var(--gold-glow)}50%{box-shadow:0 0 25px var(--gold-glow),0 0 40px rgba(212,168,83,.15)}}

/* Modal */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(5px);z-index:100;align-items:center;justify-content:center;padding:16px}
.modal-overlay.visible{display:flex}
.modal-card{background:var(--deep-navy);border:1px solid var(--card-border);border-radius:var(--radius-lg);padding:28px 24px;width:100%;max-width:380px;animation:modalIn .25s ease}
@keyframes modalIn{from{opacity:0;transform:scale(.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-card h3{font-family:var(--font-display);font-size:1.1rem;color:var(--gold-light);margin-bottom:4px}
.modal-card .modal-square-label{font-size:.9rem;color:var(--white-soft);margin-bottom:16px;padding:10px;background:rgba(255,255,255,.05);border-radius:var(--radius-sm);border-left:3px solid var(--gold)}
.modal-actions{display:flex;gap:10px;margin-top:16px}.modal-actions .btn{flex:1}

/* Admin */
.admin-section{background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius);padding:20px;margin-bottom:14px;backdrop-filter:blur(10px)}
.admin-section h3{font-family:var(--font-display);font-size:1rem;color:var(--gold-light);margin-bottom:12px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.admin-timer-display{font-family:var(--font-display);font-size:clamp(2rem,8vw,3rem);font-weight:700;color:var(--gold-light);text-align:center;margin:12px 0;letter-spacing:3px;text-shadow:0 0 20px var(--gold-glow)}
.admin-timer-controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
.timer-input-row{display:flex;gap:8px;align-items:center;justify-content:center;margin-bottom:12px}
.timer-input-row span{color:var(--white-muted);font-size:.85rem}
.game-mode-selector{display:flex;gap:8px;flex-wrap:wrap}
.mode-btn{flex:1;min-width:90px;padding:10px 12px;background:rgba(255,255,255,.06);border:2px solid transparent;border-radius:var(--radius-sm);color:var(--white-muted);font-family:var(--font-body);font-size:.8rem;font-weight:600;cursor:pointer;transition:all .2s;text-align:center}
.mode-btn:hover{background:rgba(255,255,255,.1)}
.mode-btn.active{border-color:var(--teal);color:var(--teal);background:var(--teal-glow)}
.mode-btn .mode-name{display:block;margin-bottom:2px}.mode-btn .mode-desc{font-size:.65rem;font-weight:400;opacity:.7}
.leaderboard-list{list-style:none}
.leaderboard-item{display:flex;align-items:center;gap:12px;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.06)}
.leaderboard-item:last-child{border-bottom:none}
.lb-rank{font-family:var(--font-display);font-size:1.1rem;font-weight:700;color:var(--white-muted);min-width:28px;text-align:center}
.lb-rank.gold{color:#ffd700}.lb-rank.silver{color:#c0c0c0}.lb-rank.bronze{color:#cd7f32}
.lb-name{flex:1;font-weight:500;font-size:.9rem}.lb-count{font-weight:700;color:var(--teal);font-size:.9rem}
.lb-winner{background:linear-gradient(135deg,rgba(212,168,83,.15),rgba(46,196,182,.05));border-radius:var(--radius-sm)}
.admin-winner-alert{display:none;text-align:center;padding:16px;margin-bottom:14px;background:linear-gradient(135deg,rgba(212,168,83,.25),rgba(46,196,182,.15));border:2px solid var(--gold);border-radius:var(--radius);animation:winPulse 2s ease-in-out infinite}
.admin-winner-alert.visible{display:block}
.admin-winner-alert h3{font-family:var(--font-display);color:var(--gold-light);justify-content:center}
.admin-winner-alert .winner-names{font-size:1.1rem;font-weight:700;color:var(--teal);margin-top:6px}
.player-count-badge{display:inline-flex;align-items:center;gap:4px;background:var(--teal-glow);color:var(--teal);padding:4px 10px;border-radius:20px;font-size:.75rem;font-weight:600}
.square-edit-row{display:flex;gap:8px;align-items:center;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.05)}
.square-edit-num{font-size:.7rem;color:var(--white-muted);min-width:22px;text-align:right}
.square-edit-input{flex:1;padding:8px 10px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:var(--radius-sm);color:var(--white);font-family:var(--font-body);font-size:.8rem;outline:none}
.square-edit-input:focus{border-color:var(--gold)}
.summary-header{text-align:center;margin-bottom:16px}
.summary-header h2{font-family:var(--font-display);font-size:clamp(1.2rem,5vw,1.5rem);color:var(--gold-light)}
.summary-header .summary-count{font-size:1rem;color:var(--teal);font-weight:600;margin-top:6px}
.summary-list{list-style:none;margin-bottom:20px}
.summary-item{padding:10px 12px;margin-bottom:6px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius-sm);border-left:3px solid var(--gold)}
.summary-item .met-name{font-weight:700;color:var(--gold-light)}
.summary-item .met-desc{font-size:.85rem;color:var(--white-soft);margin-top:2px}
.rating-row{display:flex;gap:8px;justify-content:center;margin:12px 0 16px}
.rating-btn{width:48px;height:48px;border-radius:var(--radius-sm);border:2px solid transparent;font-size:1.2rem;font-weight:700;cursor:pointer;transition:all .2s;color:var(--white);display:flex;align-items:center;justify-content:center}
.rating-btn:hover{transform:scale(1.1)}
.rating-btn.selected{border-color:var(--white);transform:scale(1.15);box-shadow:0 0 15px rgba(255,255,255,.2)}
.rating-btn[data-r="1"]{background:#e74c3c}.rating-btn[data-r="2"]{background:#e67e22}.rating-btn[data-r="3"]{background:#f1c40f;color:var(--midnight)}.rating-btn[data-r="4"]{background:#2ecc71}.rating-btn[data-r="5"]{background:#27ae60}
.feedback-item{padding:10px 14px;margin-bottom:8px;background:var(--card-bg);border:1px solid var(--card-border);border-radius:var(--radius-sm)}
.feedback-item .fb-player{font-weight:600;color:var(--gold-light);font-size:.85rem}
.feedback-item .fb-rating{display:inline-block;padding:2px 8px;border-radius:4px;font-weight:700;font-size:.75rem;margin-left:6px}
.feedback-item .fb-text{font-size:.85rem;color:var(--white-soft);margin-top:4px}
.loading-spinner{display:inline-block;width:20px;height:20px;border:2px solid var(--white-muted);border-top-color:var(--gold);border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.screen-loading{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;color:var(--white-muted);font-size:.85rem}
.screen-loading .loading-spinner{width:36px;height:36px;border-width:3px}
.logout-area{text-align:center;padding:12px 0;flex-shrink:0}
@media(max-width:600px){.moon-decoration{width:40px;height:40px;top:12px;right:16px;box-shadow:inset -12px -2px 0 0 var(--gold),0 0 15px var(--gold-glow)}}
@media(max-width:380px){.login-card{padding:24px 16px}}
</style>
</head>
<body>
<div class="moon-decoration"></div>
<svg class="lantern lantern-1" viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30 0v15M25 15h10M20 25c0-5 4-10 10-10s10 5 10 10v30c0 8-4 15-10 18-6-3-10-10-10-18V25z" stroke="#d4a853" stroke-width="1.5" fill="rgba(212,168,83,.2)"/><path d="M22 30h16M22 40h16M22 50h16" stroke="#d4a853" stroke-width=".8" opacity=".6"/><circle cx="30" cy="80" r="3" fill="#d4a853" opacity=".5"/></svg>
<svg class="lantern lantern-2" viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30 0v15M25 15h10M20 25c0-5 4-10 10-10s10 5 10 10v30c0 8-4 15-10 18-6-3-10-10-10-18V25z" stroke="#d4a853" stroke-width="1.5" fill="rgba(212,168,83,.2)"/><path d="M22 30h16M22 40h16M22 50h16" stroke="#d4a853" stroke-width=".8" opacity=".6"/><circle cx="30" cy="80" r="3" fill="#d4a853" opacity=".5"/></svg>
<svg class="lantern lantern-3" viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30 0v15M25 15h10M20 25c0-5 4-10 10-10s10 5 10 10v30c0 8-4 15-10 18-6-3-10-10-10-18V25z" stroke="#d4a853" stroke-width="1.5" fill="rgba(212,168,83,.2)"/><path d="M22 30h16M22 40h16M22 50h16" stroke="#d4a853" stroke-width=".8" opacity=".6"/><circle cx="30" cy="80" r="3" fill="#d4a853" opacity=".5"/></svg>
<svg class="lantern lantern-4" viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30 0v15M25 15h10M20 25c0-5 4-10 10-10s10 5 10 10v30c0 8-4 15-10 18-6-3-10-10-10-18V25z" stroke="#d4a853" stroke-width="1.5" fill="rgba(212,168,83,.2)"/><path d="M22 30h16M22 40h16M22 50h16" stroke="#d4a853" stroke-width=".8" opacity=".6"/><circle cx="30" cy="80" r="3" fill="#d4a853" opacity=".5"/></svg>
<svg class="lantern lantern-5" viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30 0v15M25 15h10M20 25c0-5 4-10 10-10s10 5 10 10v30c0 8-4 15-10 18-6-3-10-10-10-18V25z" stroke="#d4a853" stroke-width="1.5" fill="rgba(212,168,83,.2)"/><path d="M22 30h16M22 40h16M22 50h16" stroke="#d4a853" stroke-width=".8" opacity=".6"/><circle cx="30" cy="80" r="3" fill="#d4a853" opacity=".5"/></svg>
<svg class="lantern lantern-6" viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M30 0v15M25 15h10M20 25c0-5 4-10 10-10s10 5 10 10v30c0 8-4 15-10 18-6-3-10-10-10-18V25z" stroke="#d4a853" stroke-width="1.5" fill="rgba(212,168,83,.2)"/><path d="M22 30h16M22 40h16M22 50h16" stroke="#d4a853" stroke-width=".8" opacity=".6"/><circle cx="30" cy="80" r="3" fill="#d4a853" opacity=".5"/></svg>
<div class="toast-container" id="toastContainer"></div>
<div class="timer-bar" id="globalTimerBar"><span>&#9201;</span><div><div class="timer-display" id="globalTimerDisplay">10:00</div><div class="timer-label">Time Remaining</div></div></div>

<!-- LOADING -->
<div class="screen active" id="loadingScreen"><div class="screen-inner"><div class="screen-header"><h1>Sisters Qiyaam Bingo</h1><div class="subtitle">Ramadan 2026</div></div><div class="screen-loading"><div class="loading-spinner"></div><span>Loading...</span></div><div class="screen-footer">Sisters Qiyaam Bingo &middot; v3.5.0</div></div></div>

<!-- LOGIN -->
<div class="screen" id="loginScreen"><div class="screen-inner"><div class="screen-header"><h1>Sisters Qiyaam Bingo</h1><div class="subtitle">Ramadan 2026</div></div><div class="login-center"><div class="login-card">
  <h2>Assalamu Alaikum! &#128075;</h2><p class="login-sub">Enter your info to join tonight's game</p>
  <div class="form-group"><label for="loginFirst">First Name</label><input type="text" id="loginFirst" placeholder="e.g. Amira" autocomplete="given-name" autocapitalize="words"></div>
  <div class="form-group"><label for="loginLast">Last Name</label><input type="text" id="loginLast" placeholder="e.g. Shah" autocomplete="family-name" autocapitalize="words"></div>
  <div class="form-group"><label>Today's Date</label><input type="text" id="loginDateDisplay" readonly style="opacity:.6;cursor:default;"></div>
  <button class="btn btn-primary w-full" id="loginBtn" onclick="handleLogin()">Join Game &#10024;</button>
  <div class="login-error" id="loginError"></div>
</div></div><div class="screen-footer">Sisters Qiyaam Bingo &middot; v3.7.0</div></div></div>

<!-- LOBBY -->
<div class="screen" id="lobbyScreen"><div class="screen-inner"><div class="screen-header"><h1>Sisters Qiyaam Bingo</h1><div class="subtitle">Ramadan 2026</div></div><div class="lobby-center">
  <div class="loading-spinner"></div><h2>&#127775; Get Ready!</h2>
  <p class="lobby-sub">The game will begin when your host starts the timer.</p>
  <div id="floatingMessages"></div>
</div><div class="logout-area"><button class="btn btn-secondary btn-small" onclick="logout()">Log Out</button></div><div class="screen-footer">Sisters Qiyaam Bingo &middot; v3.7.0</div></div></div>

<!-- BOARD -->
<div class="screen" id="boardScreen"><div class="screen-inner" id="boardInner">
  <div class="screen-header" style="padding:12px 0 4px"><h1 style="font-size:clamp(1rem,4vw,1.3rem)">Sisters Qiyaam Bingo</h1></div>
  <div class="board-header"><div><span class="player-name" id="playerName"></span></div><span class="filled-count" id="filledCount">0/25</span></div>
  <div class="game-rules-tag" id="gameRulesTag"></div>
  <div class="bingo-grid" id="bingoGrid"></div>
  <div class="logout-area"><button class="btn btn-secondary btn-small" onclick="logout()">Log Out</button></div>
</div></div>

<!-- BINGO CELEBRATION -->
<div class="screen" id="bingoScreen"><div class="screen-inner"><div class="bingo-celebrate">
  <div class="celebrate-emoji">&#127881;</div><h1>BINGO!</h1>
  <p class="celebrate-sub">MashaAllah, you did it!</p>
  <button class="btn btn-primary mt-12" onclick="showScreen('boardScreen')">Back to Board</button>
</div></div></div>

<!-- SUMMARY -->
<div class="screen" id="summaryScreen"><div class="screen-inner"><div class="screen-header"><h1>Sisters Qiyaam Bingo</h1><div class="subtitle">Ramadan 2026</div></div>
  <div class="summary-header"><h2>&#127775; JazakiAllah Khair! &#127775;</h2><div class="summary-count" id="summaryCount"></div></div>
  <ul class="summary-list" id="summaryList"></ul>
  <div class="admin-section" id="feedbackSection">
    <h3>&#11088; Rate Tonight's Game</h3>
    <div class="rating-row"><button class="rating-btn" data-r="1" onclick="selectRating(1)">1</button><button class="rating-btn" data-r="2" onclick="selectRating(2)">2</button><button class="rating-btn" data-r="3" onclick="selectRating(3)">3</button><button class="rating-btn" data-r="4" onclick="selectRating(4)">4</button><button class="rating-btn" data-r="5" onclick="selectRating(5)">5</button></div>
    <div class="form-group"><label for="feedbackText">Feedback (optional)</label><textarea id="feedbackText" placeholder="What did you enjoy? Any suggestions?"></textarea></div>
    <label class="check-row"><input type="checkbox" id="feedbackAnon"> Submit anonymously</label>
    <button class="btn btn-primary w-full" id="feedbackSubmitBtn" onclick="submitFeedback()">Submit Feedback &#128140;</button>
    <div id="feedbackThanks" class="hidden" style="text-align:center;margin-top:12px;color:var(--teal);font-weight:600;">Thank you! &#128150;</div>
  </div>
<div class="screen-footer">Sisters Qiyaam Bingo &middot; v3.7.0</div></div></div>

<!-- ADMIN -->
<div class="screen" id="adminScreen"><div class="screen-inner"><div class="screen-header"><h1>Sisters Qiyaam Bingo</h1><div class="subtitle">Ramadan 2026</div></div>
  <div class="admin-winner-alert" id="adminWinnerAlert"><h3>&#127942; We Have a Winner!</h3><div class="winner-names" id="adminWinnerNames"></div></div>
  <div class="admin-section"><h3>&#9201; Timer</h3><div class="timer-input-row"><input type="number" id="adminTimerMinutes" min="1" max="60" value="10" style="width:70px;text-align:center;padding:8px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.15);border-radius:8px;color:white;font-size:1rem;"><span style="color:rgba(255,255,255,.5);font-size:.85rem;">minutes</span></div><div class="admin-timer-display" id="adminTimerDisplay">10:00</div><div class="admin-timer-controls"><button class="btn btn-primary btn-small" onclick="adminStartTimer()">&#9654; Start</button><button class="btn btn-secondary btn-small" onclick="adminStopTimer()">&#9208; Pause</button><button class="btn btn-danger btn-small" onclick="adminResetTimer()">&#8634; Reset</button></div></div>
  <div class="admin-section"><h3>&#127918; Game Mode</h3><div class="game-mode-selector"><button class="mode-btn" data-mode="easy" onclick="setGameMode('easy')"><span class="mode-name">Easy</span><span class="mode-desc">Corners only</span></button><button class="mode-btn active" data-mode="medium" onclick="setGameMode('medium')"><span class="mode-name">Medium</span><span class="mode-desc">Row / Col / Diagonal</span></button><button class="mode-btn" data-mode="hard" onclick="setGameMode('hard')"><span class="mode-name">Hard</span><span class="mode-desc">Blackout</span></button></div></div>
  <div class="admin-section"><h3>&#9999; Edit Bingo Squares</h3><p style="font-size:.75rem;color:var(--white-muted);margin-bottom:10px;">Review and edit before starting. Updates all phones in real time.</p><div id="squareEditList"></div><button class="btn btn-primary btn-small w-full mt-12" onclick="saveSquareEdits()">Save Square Changes</button></div>
  <div class="admin-section"><h3>&#127942; Leaderboard <span class="player-count-badge" id="playerCountBadge">0 players</span></h3><ol class="leaderboard-list" id="leaderboardList"><li class="leaderboard-item" style="justify-content:center;color:var(--white-muted);font-size:.8rem;">No players yet...</li></ol></div>
  <div class="admin-section" id="adminEndGameSection"><h3>&#128721; End Game</h3><p style="font-size:.8rem;color:var(--white-muted);margin-bottom:10px;">All players see summary + feedback.</p><button class="btn btn-danger w-full" onclick="adminEndGame()">End Game For Everyone</button></div>
  <div class="admin-section hidden" id="adminFeedbackSection"><h3>&#128172; Player Feedback</h3><div id="adminFeedbackList"><p style="font-size:.8rem;color:var(--white-muted);">Waiting for feedback...</p></div></div>
  <div class="admin-section"><h3>&#9881; Admin</h3><button class="btn btn-danger btn-small w-full" onclick="adminResetGame()">&#128465; Reset All Game Data</button><button class="btn btn-secondary btn-small w-full mt-8" onclick="logout()">Log Out</button></div>
<div class="screen-footer">Sisters Qiyaam Bingo &middot; v3.7.0</div></div></div>

<!-- MODAL -->
<div class="modal-overlay" id="squareModal"><div class="modal-card">
  <h3>Who did you meet that...</h3><div class="modal-square-label" id="modalSquareLabel"></div>
  <div class="form-group"><label for="modalFirstName">First Name</label><input type="text" id="modalFirstName" placeholder="e.g. Fatima" autocomplete="off" autocapitalize="words"></div>
  <div class="form-group"><label for="modalLastName">Last Name</label><input type="text" id="modalLastName" placeholder="e.g. Khan" autocomplete="off" autocapitalize="words"></div>
  <div class="modal-actions"><button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="submitSquare()">Submit &#10003;</button></div>
</div></div>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({apiKey:"AIzaSyBnz3pSV35PeBgHBwY2nblIPVnwZytA2ww",authDomain:"sistersbingo-ffcce.firebaseapp.com",projectId:"sistersbingo-ffcce",storageBucket:"sistersbingo-ffcce.firebasestorage.app",messagingSenderId:"6024334326",appId:"1:6024334326:web:7d2d821f20fc1285f615d7"});
var db=firebase.firestore();
var DEFAULT_SQUARES=["Plays a sport","Has made a Ramadan goal for herself this year","Has a pet","Has a water bottle with them","Prayed taraweeh earlier tonight","Listens to podcasts","Has an Islamic app on her phone","Is wearing contacts","Has a sweet tooth","Has attended a Family Hike before","Moved to DFW less than 5 years ago","Can speak more than 1 language","Ate suhoor this morning","Is wearing your favorite color hijab","Born in the same month as you","Has lived in more than one state","Loves matcha","Loves savory or salty snacks","Crochets, knits, or sews","Has lost her hijab pin or magnet before","Has the same favorite color as you","Is attending her first Qiyaam","Goes to the same school as you","Wears the same shoe size as you"];
var FREE_SPACE="Girls Qiyaam 2026",ADMIN_FIRST="fazena",ADMIN_LAST_START="b",TIMER_SECONDS=600;
var LOBBY_MESSAGES=["Get ready to mingle!","Don\u2019t be afraid to meet new sisters!","Making new friends is sunnah!","Step outside your comfort zone!","Say salaam to someone new!","You might meet your new best friend tonight!","Smile \u2014 it\u2019s charity!","The best gatherings are of dhikr and community"];
function getTodayStr(){var d=new Date();return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0')}
function getTodayDisplay(){return new Date().toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'})}
var currentPlayer=null,isAdmin=false,selectedCellIndex=null,unsubscribers=[],timerInterval=null,selectedRating=0,hasShownBingoCelebration=false;
var gameSettings={mode:'medium',timerEnd:null,timerRunning:false,timerRemaining:TIMER_SECONDS,gameEnded:false,gameStarted:false,squares:null};
var currentEventDate=getTodayStr(),liveSquareLabels=null;
function escapeHtml(s){if(!s)return'';var d=document.createElement('div');d.textContent=s;return d.innerHTML}
function showScreen(id){document.querySelectorAll('.screen').forEach(function(s){s.classList.remove('active')});var el=document.getElementById(id);if(el){el.classList.add('active');el.scrollTop=0}}
function generatePlayerId(first,last,date){return(first.trim().toLowerCase()+'_'+last.trim().toLowerCase().replace(/[^a-z]/g,'')+'_'+date)}
function shuffleArray(arr){var a=arr.slice();for(var i=a.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=a[i];a[i]=a[j];a[j]=t}return a}
function generateBoard(labels){var shuffled=shuffleArray(labels);shuffled.splice(12,0,FREE_SPACE);return shuffled.slice(0,25)}
function formatTime(sec){if(sec<0)sec=0;return Math.floor(sec/60)+':'+String(sec%60).padStart(2,'0')}
function showToast(msg){var c=document.getElementById('toastContainer');var t=document.createElement('div');t.className='toast';t.textContent=msg;c.appendChild(t);setTimeout(function(){if(t.parentNode)t.remove()},4000)}
function tryVibrate(p){if(navigator.vibrate){try{navigator.vibrate(p)}catch(e){}}}
function getGameRulesText(m){if(m==='easy')return'Fill all 4 corners to win!';if(m==='hard')return'Fill every single square to win! (Blackout)';return'Complete any full row, column, or diagonal to win!'}
function initLobbyMessages(){var c=document.getElementById('floatingMessages');c.innerHTML='';var pos=[{t:'15%',l:'5%'},{t:'35%',r:'5%'},{t:'55%',l:'8%'},{t:'75%',r:'8%'},{t:'25%',l:'12%'}];for(var i=0;i<5;i++){var el=document.createElement('div');el.className='floating-msg';el.textContent=LOBBY_MESSAGES[i%LOBBY_MESSAGES.length];el.style.top=pos[i].t;if(pos[i].l)el.style.left=pos[i].l;else el.style.right=pos[i].r;el.style.animationDelay=(i*2.5)+'s';c.appendChild(el)}}
function cleanup(){unsubscribers.forEach(function(u){try{u()}catch(e){}});unsubscribers=[];if(timerInterval){clearInterval(timerInterval);timerInterval=null}}
function logout(){cleanup();currentPlayer=null;isAdmin=false;selectedCellIndex=null;selectedRating=0;liveSquareLabels=null;hasShownBingoCelebration=false;sessionStorage.removeItem('bingo_player_id');sessionStorage.removeItem('bingo_event_date');document.getElementById('globalTimerBar').classList.remove('visible');document.getElementById('loginFirst').value='';document.getElementById('loginLast').value='';document.getElementById('loginError').textContent='';showScreen('loginScreen')}
async function handleLogin(){var first=document.getElementById('loginFirst').value.trim();var last=document.getElementById('loginLast').value.trim();var eventDate=getTodayStr();var errorEl=document.getElementById('loginError');if(!first||!last){errorEl.textContent='Please enter your first and last name.';return}errorEl.textContent='';document.getElementById('loginBtn').disabled=true;currentEventDate=eventDate;sessionStorage.setItem('bingo_event_date',eventDate);try{if(first.toLowerCase()===ADMIN_FIRST&&last.toLowerCase().charAt(0)===ADMIN_LAST_START){isAdmin=true;sessionStorage.setItem('bingo_player_id','__admin__');document.getElementById('loginBtn').disabled=false;showScreen('adminScreen');initAdmin();return}var playerId=generatePlayerId(first,last,eventDate);var docRef=db.collection('players').doc(playerId);var doc=await docRef.get();if(doc.exists){currentPlayer=Object.assign({},doc.data(),{id:playerId});sessionStorage.setItem('bingo_player_id',playerId);document.getElementById('loginBtn').disabled=false;if(currentPlayer.gameEnded){showScreen('summaryScreen');renderSummary();startPlayerListeners()}else{routePlayer()}return}var settingsDoc=await db.collection('game').doc('settings').get();var squareLabels=DEFAULT_SQUARES;if(settingsDoc.exists&&settingsDoc.data().squares&&settingsDoc.data().squares.length===24)squareLabels=settingsDoc.data().squares;if(settingsDoc.exists)gameSettings=Object.assign({},gameSettings,settingsDoc.data());var board=generateBoard(squareLabels);var newPlayer={firstName:first,lastName:last,eventDate:eventDate,board:board,filledSquares:{},filledCount:1,winner:false,gameEnded:false};var freeIdx=board.indexOf(FREE_SPACE);if(freeIdx!==-1)newPlayer.filledSquares[String(freeIdx)]='\uD83C\uDF19';await docRef.set(newPlayer);currentPlayer=Object.assign({},newPlayer,{id:playerId});sessionStorage.setItem('bingo_player_id',playerId);document.getElementById('loginBtn').disabled=false;routePlayer()}catch(err){console.error('Login error:',err);errorEl.textContent='Something went wrong. Please try again.';document.getElementById('loginBtn').disabled=false}}
function routePlayer(){if(!currentPlayer)return;if(gameSettings.gameStarted){showScreen('boardScreen');initBoard()}else{showScreen('lobbyScreen');initLobbyMessages();startPlayerListeners()}}
function initBoard(){if(!currentPlayer)return;document.getElementById('playerName').textContent=escapeHtml(currentPlayer.firstName)+' '+escapeHtml(currentPlayer.lastName);renderGrid();startPlayerListeners()}
function getResolvedLabel(i){var orig=currentPlayer.board[i];if(orig===FREE_SPACE)return FREE_SPACE;if(!liveSquareLabels)return orig;var defIdx=DEFAULT_SQUARES.indexOf(orig);if(defIdx!==-1&&liveSquareLabels[defIdx])return liveSquareLabels[defIdx];return orig}
function renderGrid(){var grid=document.getElementById('bingoGrid');grid.innerHTML='';var board=currentPlayer.board,filled=currentPlayer.filledSquares||{};for(var i=0;i<25;i++){var cell=document.createElement('div');cell.className='bingo-cell';cell.dataset.index=i;var label=getResolvedLabel(i),isFree=board[i]===FREE_SPACE,isFilled=filled[String(i)]!=null;if(isFree){cell.classList.add('free-space','filled');cell.innerHTML='<span class="cell-label">'+escapeHtml(label)+'</span>'}else if(isFilled){cell.classList.add('filled');cell.innerHTML='<span class="cell-label">'+escapeHtml(label)+'</span><span class="cell-sister">'+escapeHtml(filled[String(i)])+'</span>'}else{cell.innerHTML='<span class="cell-label">'+escapeHtml(label)+'</span>';(function(idx){cell.addEventListener('click',function(){openModal(idx)})})(i)}grid.appendChild(cell)}document.getElementById('filledCount').textContent=(currentPlayer.filledCount||Object.keys(filled).length)+'/25';document.getElementById('gameRulesTag').textContent=getGameRulesText(gameSettings.mode)}
function openModal(idx){selectedCellIndex=idx;var label=getResolvedLabel(idx);document.getElementById('modalSquareLabel').textContent=label.charAt(0).toLowerCase()+label.slice(1)+'?';document.getElementById('modalFirstName').value='';document.getElementById('modalLastName').value='';document.getElementById('squareModal').classList.add('visible');setTimeout(function(){document.getElementById('modalFirstName').focus()},100)}
function closeModal(){document.getElementById('squareModal').classList.remove('visible');selectedCellIndex=null}
async function submitSquare(){if(selectedCellIndex===null||!currentPlayer)return;var fn=document.getElementById('modalFirstName').value.trim();var ln=document.getElementById('modalLastName').value.trim();if(!fn||!ln)return;var fullName=fn+' '+ln;var idx=String(selectedCellIndex);try{var newFilled=Object.assign({},currentPlayer.filledSquares);newFilled[idx]=fullName;var newCount=Object.keys(newFilled).length;var upd={};upd['filledSquares.'+idx]=fullName;upd.filledCount=newCount;await db.collection('players').doc(currentPlayer.id).update(upd);currentPlayer.filledSquares=newFilled;currentPlayer.filledCount=newCount;closeModal();renderGrid();checkWinCondition()}catch(err){console.error('Submit error:',err);alert('Could not save. Please try again.')}}
function checkWinCondition(){if(!currentPlayer)return;var filled=new Set(Object.keys(currentPlayer.filledSquares||{}).map(Number));var mode=gameSettings.mode||'medium',won=false;if(mode==='easy'){won=[0,4,20,24].every(function(i){return filled.has(i)})}else if(mode==='hard'){won=filled.size>=25}else{var lines=[[0,1,2,3,4],[5,6,7,8,9],[10,11,12,13,14],[15,16,17,18,19],[20,21,22,23,24],[0,5,10,15,20],[1,6,11,16,21],[2,7,12,17,22],[3,8,13,18,23],[4,9,14,19,24],[0,6,12,18,24],[4,8,12,16,20]];won=lines.some(function(line){return line.every(function(i){return filled.has(i)})})}if(won&&!currentPlayer.winner){currentPlayer.winner=true;db.collection('players').doc(currentPlayer.id).update({winner:true}).catch(function(){});tryVibrate([200,100,200,100,400]);if(!hasShownBingoCelebration){hasShownBingoCelebration=true;showScreen('bingoScreen')}}}
function startPlayerListeners(){cleanup();var unsub1=db.collection('players').doc(currentPlayer.id).onSnapshot(function(snap){if(!snap.exists)return;var data=snap.data();currentPlayer.filledSquares=data.filledSquares||{};currentPlayer.filledCount=data.filledCount||0;currentPlayer.winner=data.winner||false;if(data.gameEnded&&!currentPlayer.gameEnded){currentPlayer.gameEnded=true;showScreen('summaryScreen');renderSummary();tryVibrate([100,50,100]);return}var active=document.querySelector('.screen.active');if(active&&active.id==='boardScreen'){renderGrid();checkWinCondition()}});unsubscribers.push(unsub1);var unsub2=db.collection('game').doc('settings').onSnapshot(function(snap){if(!snap.exists)return;var data=snap.data();var oldMode=gameSettings.mode;var wasStarted=gameSettings.gameStarted;gameSettings=Object.assign({},gameSettings,data);if(data.mode&&data.mode!==oldMode&&oldMode&&wasStarted){showToast('Game mode changed: '+getGameRulesText(data.mode));tryVibrate([100])}if(data.squares)liveSquareLabels=data.squares;if(data.gameEnded&&!currentPlayer.gameEnded){db.collection('players').doc(currentPlayer.id).update({gameEnded:true}).catch(function(){});currentPlayer.gameEnded=true;showScreen('summaryScreen');renderSummary();tryVibrate([100,50,100]);return}if(data.gameStarted&&!wasStarted){var active=document.querySelector('.screen.active');if(active&&active.id==='lobbyScreen'){showScreen('boardScreen');initBoard();showToast('Game has started! Go meet some sisters!');tryVibrate([100,50,100])}}var active2=document.querySelector('.screen.active');if(active2&&active2.id==='boardScreen'){updatePlayerTimer();renderGrid();checkWinCondition()}else if(active2&&active2.id==='lobbyScreen'){updatePlayerTimer()}});unsubscribers.push(unsub2)}
function updatePlayerTimer(){var bar=document.getElementById('globalTimerBar'),display=document.getElementById('globalTimerDisplay');if(gameSettings.timerRunning&&gameSettings.timerEnd){bar.classList.add('visible');if(timerInterval)clearInterval(timerInterval);timerInterval=setInterval(function(){var rem=Math.max(0,Math.ceil((gameSettings.timerEnd-Date.now())/1000));display.textContent=formatTime(rem);if(rem<=60)bar.classList.add('urgent');else bar.classList.remove('urgent');if(rem<=0){clearInterval(timerInterval);timerInterval=null;display.textContent='0:00'}},250)}else if(gameSettings.timerRemaining!=null&&gameSettings.timerRemaining<(gameSettings.customTimerSeconds||TIMER_SECONDS)){bar.classList.add('visible');display.textContent=formatTime(gameSettings.timerRemaining);if(timerInterval){clearInterval(timerInterval);timerInterval=null}}else{bar.classList.remove('visible');if(timerInterval){clearInterval(timerInterval);timerInterval=null}}}
function renderSummary(){if(!currentPlayer)return;var filled=currentPlayer.filledSquares||{},board=currentPlayer.board,entries=[];for(var idx in filled){if(!filled.hasOwnProperty(idx))continue;var i=parseInt(idx);if(board[i]===FREE_SPACE)continue;entries.push({name:filled[idx],desc:getResolvedLabel(i)})}document.getElementById('summaryCount').textContent='SubhanAllah! You met '+entries.length+' sister'+(entries.length!==1?'s':'')+' tonight!';var html='';entries.forEach(function(e){var dl=e.desc.charAt(0).toLowerCase()+e.desc.slice(1);html+='<li class="summary-item"><span class="met-name">'+escapeHtml(e.name)+'</span><div class="met-desc">...who '+escapeHtml(dl)+'</div></li>'});document.getElementById('summaryList').innerHTML=html||'<li style="color:var(--white-muted);text-align:center;">No squares filled yet.</li>'}
function selectRating(r){selectedRating=r;document.querySelectorAll('.rating-btn').forEach(function(b){b.classList.toggle('selected',parseInt(b.dataset.r)===r)})}
async function submitFeedback(){if(!currentPlayer)return;var text=document.getElementById('feedbackText').value.trim();var anon=document.getElementById('feedbackAnon').checked;var payload={eventDate:currentEventDate,rating:selectedRating,text:text,timestamp:Date.now(),anonymous:anon};if(anon){payload.firstName='Anonymous';payload.lastName=''}else{payload.firstName=currentPlayer.firstName;payload.lastName=currentPlayer.lastName}try{await db.collection('feedback').doc(currentPlayer.id).set(payload);document.getElementById('feedbackThanks').classList.remove('hidden');document.getElementById('feedbackSubmitBtn').disabled=true}catch(err){console.error('Feedback error:',err);alert('Could not submit. Please try again.')}}
function initAdmin(){renderSquareEditor();startAdminListeners()}
function renderSquareEditor(){var c=document.getElementById('squareEditList');var sq=(gameSettings.squares&&gameSettings.squares.length===24)?gameSettings.squares:DEFAULT_SQUARES;var html='';for(var i=0;i<24;i++){html+='<div class="square-edit-row"><span class="square-edit-num">'+(i+1)+'</span><input class="square-edit-input" data-sq="'+i+'" value="'+escapeHtml(sq[i])+'"></div>'}c.innerHTML=html}
async function saveSquareEdits(){var inputs=document.querySelectorAll('.square-edit-input');var sq=[];inputs.forEach(function(inp){sq.push(inp.value.trim()||DEFAULT_SQUARES[parseInt(inp.dataset.sq)])});try{await db.collection('game').doc('settings').set({squares:sq},{merge:true});showToast('Squares updated!')}catch(err){console.error(err);alert('Could not save.')}}
function startAdminListeners(){cleanup();var unsub1=db.collection('game').doc('settings').onSnapshot(function(snap){if(snap.exists){var data=snap.data();gameSettings=Object.assign({},gameSettings,data);if(data.gameEnded){document.getElementById('adminEndGameSection').classList.add('hidden');document.getElementById('adminFeedbackSection').classList.remove('hidden')}}updateAdminUI();renderSquareEditor()});unsubscribers.push(unsub1);var unsub2=db.collection('players').where('eventDate','==',currentEventDate).onSnapshot(function(snap){var sorted=snap.docs.slice().sort(function(a,b){return(b.data().filledCount||0)-(a.data().filledCount||0)});renderLeaderboard(sorted)});unsubscribers.push(unsub2);var unsub3=db.collection('feedback').where('eventDate','==',currentEventDate).onSnapshot(function(snap){renderAdminFeedback(snap.docs)});unsubscribers.push(unsub3)}
function updateAdminUI(){document.querySelectorAll('.mode-btn').forEach(function(b){b.classList.toggle('active',b.dataset.mode===gameSettings.mode)});var display=document.getElementById('adminTimerDisplay'),bar=document.getElementById('globalTimerBar');if(gameSettings.timerRunning&&gameSettings.timerEnd){bar.classList.add('visible');if(timerInterval)clearInterval(timerInterval);timerInterval=setInterval(function(){var rem=Math.max(0,Math.ceil((gameSettings.timerEnd-Date.now())/1000));display.textContent=formatTime(rem);document.getElementById('globalTimerDisplay').textContent=formatTime(rem);if(rem<=60)bar.classList.add('urgent');else bar.classList.remove('urgent');if(rem<=0){clearInterval(timerInterval);timerInterval=null;db.collection('game').doc('settings').update({timerRunning:false,timerRemaining:0}).catch(function(){})}},250)}else{var rem=gameSettings.timerRemaining!=null?gameSettings.timerRemaining:(gameSettings.customTimerSeconds||TIMER_SECONDS);display.textContent=formatTime(rem);if(timerInterval){clearInterval(timerInterval);timerInterval=null}if(gameSettings.gameStarted&&rem<(gameSettings.customTimerSeconds||TIMER_SECONDS)){bar.classList.add('visible');document.getElementById('globalTimerDisplay').textContent=formatTime(rem)}else{bar.classList.remove('visible')}}}
function renderLeaderboard(docs){var list=document.getElementById('leaderboardList'),badge=document.getElementById('playerCountBadge'),winAlert=document.getElementById('adminWinnerAlert'),winNames=document.getElementById('adminWinnerNames');badge.textContent=docs.length+' player'+(docs.length!==1?'s':'');if(!docs.length){list.innerHTML='<li class="leaderboard-item" style="justify-content:center;color:var(--white-muted);font-size:.8rem;">No players yet...</li>';winAlert.classList.remove('visible');return}var winners=[],html='';docs.forEach(function(doc,i){var d=doc.data(),rank=i+1,rc=rank===1?'gold':rank===2?'silver':rank===3?'bronze':'';if(d.winner)winners.push(d.firstName+' '+d.lastName);html+='<li class="leaderboard-item'+(d.winner?' lb-winner':'')+'"><span class="lb-rank '+rc+'">'+rank+'</span><span class="lb-name">'+escapeHtml(d.firstName)+' '+escapeHtml(d.lastName)+'</span><span class="lb-count">'+(d.filledCount||0)+'</span></li>'});list.innerHTML=html;if(winners.length){winAlert.classList.add('visible');winNames.textContent=winners.join(', ');winAlert.scrollIntoView({behavior:'smooth',block:'start'})}else{winAlert.classList.remove('visible')}}
function renderAdminFeedback(docs){var c=document.getElementById('adminFeedbackList');if(!docs.length){c.innerHTML='<p style="font-size:.8rem;color:var(--white-muted);">Waiting for feedback...</p>';return}var sorted=docs.slice().sort(function(a,b){return(b.data().timestamp||0)-(a.data().timestamp||0)});var rc={1:'#e74c3c',2:'#e67e22',3:'#f1c40f',4:'#2ecc71',5:'#27ae60'};var html='';sorted.forEach(function(doc){var d=doc.data();var col=rc[d.rating]||'var(--white-muted)';html+='<div class="feedback-item"><span class="fb-player">'+escapeHtml(d.firstName)+(d.lastName?' '+escapeHtml(d.lastName):'')+'</span>'+(d.rating?'<span class="fb-rating" style="background:'+col+';color:'+(d.rating===3?'var(--midnight)':'var(--white)')+'">'+d.rating+'/5</span>':'')+(d.text?'<div class="fb-text">'+escapeHtml(d.text)+'</div>':'')+'</div>'});c.innerHTML=html}
async function adminStartTimer(){var mins=parseInt(document.getElementById('adminTimerMinutes').value)||10;var totalSec=mins*60;await db.collection('game').doc('settings').set({timerRunning:true,timerEnd:Date.now()+(totalSec*1000),timerRemaining:totalSec,customTimerSeconds:totalSec,gameStarted:true},{merge:true})}
async function adminStopTimer(){if(!gameSettings.timerRunning||!gameSettings.timerEnd)return;var rem=Math.max(0,Math.ceil((gameSettings.timerEnd-Date.now())/1000));await db.collection('game').doc('settings').set({timerRunning:false,timerEnd:null,timerRemaining:rem},{merge:true})}
async function adminResetTimer(){var mins=parseInt(document.getElementById('adminTimerMinutes').value)||10;var totalSec=mins*60;await db.collection('game').doc('settings').set({timerRunning:false,timerEnd:null,timerRemaining:totalSec,customTimerSeconds:totalSec},{merge:true})}
async function setGameMode(mode){await db.collection('game').doc('settings').set({mode:mode},{merge:true})}
async function adminEndGame(){if(!confirm('Are you sure you want to end the game? All players will see their summary.'))return;if(!confirm('This cannot be undone. End game now?'))return;try{await db.collection('game').doc('settings').set({gameEnded:true,timerRunning:false,timerEnd:null},{merge:true});var snap=await db.collection('players').where('eventDate','==',currentEventDate).get();var batch=db.batch();snap.docs.forEach(function(doc){batch.update(doc.ref,{gameEnded:true})});await batch.commit();showToast('Game ended!')}catch(err){console.error(err);alert('Error ending game.')}}
async function adminResetGame(){if(!confirm('Delete ALL player data and reset? This cannot be undone!'))return;if(!confirm('Really sure?'))return;try{var snap=await db.collection('players').where('eventDate','==',currentEventDate).get();var batch=db.batch();snap.docs.forEach(function(doc){batch.delete(doc.ref)});var fbSnap=await db.collection('feedback').where('eventDate','==',currentEventDate).get();fbSnap.docs.forEach(function(doc){batch.delete(doc.ref)});await batch.commit();await db.collection('game').doc('settings').set({mode:'medium',timerRunning:false,timerEnd:null,timerRemaining:TIMER_SECONDS,gameEnded:false,gameStarted:false,squares:null,customTimerSeconds:null});document.getElementById('adminEndGameSection').classList.remove('hidden');document.getElementById('adminFeedbackSection').classList.add('hidden');showToast('Game reset complete!')}catch(err){console.error(err);alert('Error resetting game.')}}
async function init(){document.getElementById('loginDateDisplay').value=getTodayDisplay();var savedId=sessionStorage.getItem('bingo_player_id'),savedDate=sessionStorage.getItem('bingo_event_date');if(savedDate)currentEventDate=savedDate;if(savedId==='__admin__'){isAdmin=true;showScreen('adminScreen');initAdmin();return}if(savedId){try{var settSnap=await db.collection('game').doc('settings').get();if(settSnap.exists)gameSettings=Object.assign({},gameSettings,settSnap.data());var doc=await db.collection('players').doc(savedId).get();if(doc.exists){currentPlayer=Object.assign({},doc.data(),{id:savedId});if(currentPlayer.gameEnded){showScreen('summaryScreen');renderSummary();startPlayerListeners()}else{routePlayer()}return}}catch(e){console.error('Session restore error:',e)}}showScreen('loginScreen')}
document.querySelectorAll('#loginScreen input:not([readonly])').forEach(function(inp){inp.addEventListener('keydown',function(e){if(e.key==='Enter')handleLogin()})});
document.getElementById('squareModal').addEventListener('click',function(e){if(e.target===e.currentTarget)closeModal()});
document.getElementById('modalLastName').addEventListener('keydown',function(e){if(e.key==='Enter')submitSquare()});
db.collection('game').doc('settings').get().then(function(snap){if(!snap.exists)db.collection('game').doc('settings').set({mode:'medium',timerRunning:false,timerEnd:null,timerRemaining:TIMER_SECONDS,gameEnded:false,gameStarted:false,squares:null,customTimerSeconds:null})}).catch(function(){});
init();
</script>
</body>
</html>
